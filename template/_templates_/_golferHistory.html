[%divId="golfScore"%]
[%spwfResource="golf_score"%]
[%prkey="golf_score_id"%]

<script type="text/javascript">
//<![CDATA[

//Server Calls
function retrieve[%ucfirst(divId)%]List(golferId_){
  $("#[%divId%]ListTable").html("");
  var params =prepParams(params,"[%spwfResource%]" ,"select" );
  params['where_clause'] = "golfer_id =" + golferId_;
  var successf = function (rslt){
	populate[%ucfirst(divId)%](rslt.rows)
  };
  serverCall(params,successf,FAILF);
}
function retrieve[%ucfirst(divId)%](params){"use strict";
  params = prepParams(params,"[%spwfResource%]","SELECT");
  var successf = function(rslt){
	rslt.rows[0].game_dt = pgDate(rslt.rows[0].game_dt);
	bindToForm("[%divId%]Form", rslt.rows[0]);
  }
  serverCall(params,successf,FAILF);
}
function delete[%ucfirst(divId)%]([%toCC(prkey)%]_, lastUpdate_){
  var params =prepParams(params,"[%spwfResource%]" ,"delete" );
  params['[%prkey%]'] = [%toCC(prkey)%]_;
  params['last_update'] = lastUpdate_;
  var successf = function (rslt){
	remove[%ucfirst(divId)%]ListTableRow(rslt.[%prkey%])
  };
  serverCall(params,successf,FAILF);
}

function save[%ucfirst(divId)%](params){
  params = prepParams(params,"[%spwfResource%]",insertUpdateChoose);
  var successf=function(rslt){
	clearForm('[%divId%]Form');
	if (rslt.spwfAction == "UPDATE"){
		replace[%ucfirst(divId)%]ListTableRow(rslt.rows[0]);
	}else if (rslt.spwfAction == "INSERT"){
		addNew[%ucfirst(divId)%]ListTableRow(rslt.rows[0]);
	}
	briefNotify("Successfully Saved");

  };
  serverCall(params,successf,FAILF);
}

//ServerCall Wrappers
function edit[%ucfirst(divId)%]([%divId%]Id_){
  if([%divId%]Id_){
	var params ={"where_clause":"[%prkey%]=" +[%divId%]Id_};
	retrieve[%ucfirst(divId)%](params);
  }
}

function save[%ucfirst(divId)%]Form(){
  var params = bindForm("[%divId%]Form");
  save[%ucfirst(divId)%](params);
}


//Top Level HTML Manip
function populate[%ucfirst(divId)%](dataRows){
  var htmlAggregator ="<tr> <th>Score</th><th>Date</th> <th>Action</th></tr>";
  for(ndx=0;ndx< dataRows.length;ndx++){
	htmlAggregator +=build[%ucfirst(divId)%]ListTableRow(dataRows[ndx]);
  }
  $("#[%divId%]ListTable").html(htmlAggregator);
}

function build[%ucfirst(divId)%]ListTableRow(data){
	var htmlRow ="<tr id='[%ucfirst(divId)%]ListTableTR-" +data.[%prkey%] + "'><td>";
	htmlRow += formatNumber(data.golf_score,0,true,false,true)  +"</td>";
	htmlRow += "<td>" + pgDate(data.game_dt) + " </td> ";
	htmlRow += "<td><a class='alink' onclick='edit[%ucfirst(divId)%](" +data.[%prkey%] + ")'>Edit</a> |"
	htmlRow += "<a class='alink' onclick=\"delete[%ucfirst(divId)%](" +data.[%prkey%] + ",'"+data.last_update +"')\">Delete</a>  </td> </tr>";
	return htmlRow;
}

function replace[%ucfirst(divId)%]ListTableRow(row){"use strict";
  $("table#[%divId%]ListTable #[%ucfirst(divId)%]ListTableTR-"+row.[%prkey%]  ).replaceWith(build[%ucfirst(divId)%]ListTableRow(row));
}
function addNew[%ucfirst(divId)%]ListTableRow(row){"use strict";
  $("table#[%divId%]ListTable TR").first().after(build[%ucfirst(divId)%]ListTableRow(row));
}
function remove[%ucfirst(divId)%]ListTableRow([%toCC(prkey)%]_){"use strict";
  $("table#[%divId%]ListTable #[%ucfirst(divId)%]ListTableTR-"+[%toCC(prkey)%]_  ).replaceWith("");
}



//Div Access and App Layout Calls
function show[%ucfirst(divId)%](golferId_){
  retrieve[%ucfirst(divId)%]List(golferId_); 
  hideCurrentContentPane();
  $("#[%divId%]").fadeIn();
  currentContentPane="[%divId%]";
}

//After complete Load setup
$(document).ready(function(){
  $("#[%divId%]Form-game_dt" ).datepicker();
});

//]]>

</script>
<div id="[%divId%]" class="MainLayout MainContentPaneStyle"  >
<table ><tr><td class="noborder" style="vertical-align:top;" >
  <table id="[%divId%]ListTable" style="border-width: 1px; border-style:solid; " class='dataTable' >
  </table>
</td><td class="noborder">
	<form id="[%divId%]Form" >
	<table id="[%divId%]FormTable" style="" class='formTable'>
	  <tr><td> Golfer </td><td><select name="golfer_id" id="[%divId%]Form-golfer_id"></select></td></tr>
	  <tr><td> Score </td><td><input  type="text" name="golf_score" id="[%divId%]Form-golf_score"/></td></tr>
	  <tr><td> Date</td><td><input type="text"  name="game_dt" id="[%divId%]Form-game_dt"/></td></tr>
	  <tr><td colspan="2"><button type="button" id="[%divId%]FormSave" value="Save" onclick="save[%ucfirst(divId)%]Form();" >Save</button></td></tr>
	</table>
	<input type="hidden" name="last_update" id="[%divId%]Form-last_update">
	<input type="hidden" name="golfer_score_id" id="[%divId%]Form-golf_score_id">
	</form>
</td></tr></table>
</div> <!--end:[%ucfirst(divId)%]-->
