[%divId="golfScore"%]
[%spwfResource="golf_score"%]
[%prkey="golf_score_id"%]

<script type="text/javascript">
  //<![CDATA[
"use strict";
//Server Calls
function retrieve[%ucfirst(divId)%]List(golferId_){
  $("#[%divId%]ListTable").html("");
  var params =prepParams(params,"[%spwfResource%]" ,"select" );
  params['where_clause'] = "golfer_id =" + golferId_;
  var successf = function (rslt){
    populate[%ucfirst(divId)%](rslt.rows)
  };
  serverCall(params,successf,FAILF);
}
function retrieve[%ucfirst(divId)%](params){
  params = prepParams(params,"[%spwfResource%]","SELECT");
  var successf = function(rslt){
    rslt.rows[0].game_dt = pgDate(rslt.rows[0].game_dt);
    bindToForm("[%divId%]Form", rslt.rows[0]);
    toggleSaveMode("[%divId%]Form",true);
  }
  serverCall(params,successf,FAILF);
}



function delete[%ucfirst(divId)%]([%toCC(prkey)%]_, lastUpdate_){
  var params =prepParams(params,"[%spwfResource%]" ,"delete" );
  params['[%prkey%]'] = [%toCC(prkey)%]_;
  params['last_update'] = lastUpdate_;
  var successf = function (rslt){
    remove[%ucfirst(divId)%]ListTableRow(rslt.[%prkey%]);
    briefNotify("Golf Score Deleted Successfully");
  };
  serverCall(params,successf,FAILF);
}

function save[%ucfirst(divId)%](params){
  params = prepParams(params,"[%spwfResource%]",insertUpdateChoose);
  var successf=function(rslt){
    clearForm('[%divId%]Form');
    if (rslt.spwfAction == "UPDATE"){
      replace[%ucfirst(divId)%]ListTableRow(rslt.rows[0]);
    }else if (rslt.spwfAction == "INSERT"){
      addNew[%ucfirst(divId)%]ListTableRow(rslt.rows[0]);
    }
    briefNotify("Golf Score Successfully Saved");
  };
  serverCall(params,successf,FAILF);
}

//ServerCall Wrappers
function edit[%ucfirst(divId)%]([%divId%]Id_){
  if([%divId%]Id_){
    var params ={"where_clause":"[%prkey%]=" +[%divId%]Id_};
    retrieve[%ucfirst(divId)%](params);
  }
}

function save[%ucfirst(divId)%]Form(){
  if(validate[%ucfirst(divId)%]Form()){
    var params = bindForm("[%divId%]Form");
    save[%ucfirst(divId)%](params);
  }
}

//validation
function validate[%ucfirst(divId)%]Form(){
  var formName="[%divId%]Form";
  var formValid  = standardValidate(formName);
  return formValid;
}

//Top Level HTML Manip
function populate[%ucfirst(divId)%](dataRows){
  var htmlAggregator ="<tr> <th>Score</th><th class='accentColumn'>Date</th> <th>I want to&hellip;</th></tr>";
  for(var ndx=0;ndx< dataRows.length;ndx++){
    htmlAggregator +=build[%ucfirst(divId)%]ListTableRow(dataRows[ndx]);
  }
  $("#[%divId%]ListTable").html(htmlAggregator);
}

function build[%ucfirst(divId)%]ListTableRow(data){
  var htmlRow ="<tr id='[%ucfirst(divId)%]ListTableTR-" +data.[%prkey%] + "'><td>";
  htmlRow += formatNumber(data.golf_score,0,true,false,true)  +"</td>";
  htmlRow += "<td class='accentColumn'>" + pgDate(data.game_dt) + " </td> ";
  htmlRow += "<td><a class='alink' onclick='edit[%ucfirst(divId)%](" +data.[%prkey%] + ")'>Edit</a> |"
    htmlRow += "<a class='alink' onclick=\"delete[%ucfirst(divId)%](" +data.[%prkey%] + ",'"+data.last_update +"')\">Delete</a>  </td> </tr>";
  return htmlRow;
}

function replace[%ucfirst(divId)%]ListTableRow(row){
  $("table#[%divId%]ListTable #[%ucfirst(divId)%]ListTableTR-"+row.[%prkey%]).replaceWith(build[%ucfirst(divId)%]ListTableRow(row));
}
function addNew[%ucfirst(divId)%]ListTableRow(row){
  $("table#[%divId%]ListTable TR").first().after(build[%ucfirst(divId)%]ListTableRow(row));
}
function remove[%ucfirst(divId)%]ListTableRow([%toCC(prkey)%]_){
  $("table#[%divId%]ListTable #[%ucfirst(divId)%]ListTableTR-"+[%toCC(prkey)%]_).replaceWith("");
}

//Div Access and App Layout Calls
function show[%ucfirst(divId)%](golferId_){
  retrieve[%ucfirst(divId)%]List(golferId_); 
  retrieveGolferNameForGolfScore(golferId_);
  hideCurrentContentPane();
  $("#[%divId%]").fadeIn();
  currentContentPane="[%divId%]";
  toggleSaveMode("[%divId%]Form",false);
}

//After complete Load setup
$(document).ready(function(){
    $("#[%divId%]Form-game_dt" ).datepicker();
    });

//page specific functions
function retrieveGolferNameForGolfScore(golferId_){
  var params = prepParams(params,"GOLFER","SELECT");
  params['where_clause'] = "golfer_id =" + golferId_;
  var successf = function(rslt){
    $("#[%divId%]GolferNameId").html(rslt.rows[0].name);
  }
  serverCall(params,successf,FAILF);
}


//]]>

</script>
<div id="[%divId%]" class="contentPane MainLayout"  >
  <h1 id="[%divId%]GolferNameId" class="pageTitle"></h1>
  <div class="row">
    <span class="sixcol">
      <table id="[%divId%]ListTable"  class='dataTable' >
      </table>
    </span>
    <span class = "sixcol last">
      <form id="[%divId%]Form" >
	<table id="[%divId%]FormTable"  class='formTable'>
	  <tr>
	    <td> Golfer </td>
	    <td><select name="golfer_id" id="[%divId%]Form-golfer_id"></select></td>
	    <td><span class="ValidationMsg" id="[%divId%]FormLabel-nameError"></span> </td>
	  </tr>
	  <tr>
	    <td> Score </td>
	    <td><input  type="text" name="golf_score" id="[%divId%]Form-golf_score"/></td>
	    <td><span class="ValidationMsg" id="[%divId%]FormLabel-nameError"></span></td>
	  </tr>
	  <tr>
	    <td> Date</td>
	    <td><input type="text"  name="game_dt" id="[%divId%]Form-game_dt"/></td>
	    <td><span class="ValidationMsg" id="[%divId%]FormLabel-nameError"></span></td>
	  </tr>
	  <tr><td colspan="3">
	      <button type="button" id="[%divId%]FormSave" value="Save" onclick="save[%ucfirst(divId)%]Form();" >Save</button>
	      <button type="button" id="[%divId%]FormAdd" value="Add" onclick="save[%ucfirst(divId)%]Form();" >Add</button>
	      <button type="button" id="[%divId%]FormClear" value="Clear" onclick="clearForm('[%divId%]Form');" >Clear</button>
	  </td></tr>
	</table>
	<input type="hidden" name="last_update" id="[%divId%]Form-last_update">
	<input type="hidden" name="golfer_score_id" id="[%divId%]Form-golf_score_id">
      </form>

    </span>
  </div>
</div> <!--end:[%ucfirst(divId)%]-->
